import{c as pe,r as s,j as e,b as Me,g as je,u as Be,h as _e,i as Ve,k as Ke,l as Ye,m as Xe,C as be,a as Ge,d as Qe,f as Je,B as ue,A as Ze,s as et}from"./index-9221375f.js";import{N as tt,A as st,D as rt,a as at,b as nt,c as ot,d as it,e as ct}from"./Navbar-49b57504.js";import{A as lt,a as ut,b as dt,c as mt,d as ht,e as ft,f as pt,g as gt}from"./alert-dialog-6af2529d.js";import{A as Ee}from"./AdBanner-b8f0b813.js";import"./check-2e5c824c.js";import"./x-e3e22843.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=pe("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=pe("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=pe("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=pe("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),bt={easy:{animals:["cat","dog","bird","fish","cow","pig","duck","frog","bee","ant"],actions:["run","jump","walk","sit","eat","talk","play","look","move","stop"],places:["home","park","yard","room","bed","car","tree","hill","lake","road"],times:["day","night","morning","today","now","later","soon","then","first","last"],objects:["book","ball","cup","box","bag","toy","pen","hat","key","map"],people:["man","woman","boy","girl","mom","dad","kid","baby","friend","person"],colors:["red","blue","green","black","white","brown","pink","gray","gold","dark"],sizes:["big","small","long","short","tall","wide","thin","huge","tiny","full"],qualities:["good","bad","nice","happy","sad","fast","slow","hot","cold","new"]},medium:{subjects:["technology","education","business","health","travel","culture","music","sports","food","nature"],actions:["develop","create","manage","organize","research","discover","improve","connect","support","explore"],qualities:["important","successful","creative","efficient","popular","modern","traditional","innovative","reliable","flexible"],places:["office","university","hospital","restaurant","airport","museum","library","theater","stadium","market"],people:["students","teachers","doctors","engineers","artists","musicians","athletes","writers","scientists","professionals"],concepts:["knowledge","experience","opportunity","challenge","solution","progress","success","development","communication","information"],tools:["computer","software","internet","database","system","network","platform","application","device","equipment"]},hard:{fields:["neuroscience","biotechnology","astrophysics","archaeology","psychology","philosophy","economics","linguistics","anthropology","sociology"],processes:["implementation","transformation","optimization","configuration","interpretation","experimentation","investigation","collaboration","specialization","systematization"],qualities:["comprehensive","sophisticated","revolutionary","unprecedented","extraordinary","fundamental","theoretical","experimental","controversial","phenomenological"],concepts:["consciousness","methodology","infrastructure","architecture","administration","organization","responsibility","characteristic","understanding","communication"],outcomes:["advancement","achievement","breakthrough","discovery","innovation","development","establishment","recognition","transformation","realization"],institutions:["university","laboratory","organization","administration","institution","corporation","establishment","foundation","association","confederation"]}},wt={easy:["the [animals] [actions] in the [places] when it gets [times]","[people] like to [actions] with their [objects] every [times]","a [colors] [animals] [actions] near the [places] and looks [qualities]","when [people] [actions] they feel [qualities] and [actions] more","the [sizes] [objects] sits on the [places] all [times] long","[people] can [actions] and [actions] when they have [objects]","every [times] the [animals] [actions] around the [places] quickly","most [people] [actions] their [objects] in the [places] at [times]"],medium:["During [times], [people] typically [actions] their [concepts] through [tools].","Modern [subjects] helps [people] [actions] more [qualities] solutions for daily challenges.","Many [people] visit [places] to [actions] new [concepts] and gain valuable experience.","Technology allows [people] to [actions] and [actions] their work more efficiently.","Students can [actions] important [concepts] by using various [tools] and methods.","Professional [people] often [actions] in [places] to discuss [qualities] projects.","Research shows that [subjects] continues to [actions] and transform modern society.","Organizations [actions] new [tools] to improve their [concepts] and reach better results."],hard:["Contemporary [fields] demonstrates [qualities] [concepts] that facilitate systematic [processes].","Researchers [actions] [qualities] methodologies to investigate complex [concepts] within academic [institutions].","Advanced [processes] requires comprehensive understanding of [qualities] theoretical frameworks.","Modern [institutions] implement sophisticated [tools] to optimize their organizational [processes].","Scientific [fields] continues to [actions] unprecedented [outcomes] through collaborative research initiatives.","Theoretical [concepts] underlying [qualities] [processes] represents fundamental advances in human knowledge.","Academic [institutions] facilitate [qualities] [processes] by providing comprehensive resources and expertise.","Revolutionary [outcomes] in [fields] demonstrates the extraordinary potential of systematic [processes]."]};function jt(n,d){const l=bt[d];return n.replace(/\[(\w+)\]/g,(m,c)=>{const r=l[c];return!r||r.length===0?m:r[Math.floor(Math.random()*r.length)]})}function Ct(n,d){if(d==="easy")return n.toLowerCase().replace(/[.,!?]/g,"");if(d==="medium"||d==="hard"){let l=n.toLowerCase();return l=l.charAt(0).toUpperCase()+l.slice(1),l=l.replace(/\.\s+([a-z])/g,(c,r)=>". "+r.toUpperCase()),["america","american","english","internet","technology","students","university","college","government","research","science","education","monday","tuesday","wednesday","thursday","friday","saturday","sunday","january","february","march","april","may","june","july","august","september","october","november","december"].forEach(c=>{const r=new RegExp(`\\b${c}\\b`,"gi");l=l.replace(r,h=>h.charAt(0).toUpperCase()+h.slice(1).toLowerCase())}),l}return n}function kt(n,d){const l=wt[n],m=[];let c=0;for(;c<d;){const r=l[Math.floor(Math.random()*l.length)];let h=jt(r,n);h=Ct(h,n);const y=h.split(" ").filter(w=>w.length>0),f=y.length;if(c+f<=d)m.push(h),c+=f;else{const w=d-c,v=y.slice(0,w).join(" ");m.push(v),c=d;break}}return m.join(" ")}function fe(n,d){return kt(n,d===1?70:d===2?120:300)}const Nt=({text:n,isAnimating:d,delay:l=0,staggerDelay:m=50,className:c=""})=>{const[r,h]=s.useState([]);return s.useEffect(()=>{if(!d){h(new Array(n.length).fill(!0));return}h(new Array(n.length).fill(!1)),n.split("").forEach((y,f)=>{setTimeout(()=>{h(w=>{const v=[...w];return v[f]=!0,v})},l+f*m)})},[n,d,l,m]),e.jsx("span",{className:c,children:n.split("").map((y,f)=>e.jsx("span",{className:`inline-block transition-all duration-300 ease-out ${r[f]?"opacity-100 transform translate-y-0":"opacity-0 transform translate-y-2"}`,style:{transitionDelay:d?`${f*m}ms`:"0ms"},children:y===" "?"Â ":y},f))})},St=({typingSpeed:n,isActive:d,className:l=""})=>{const m=s.useRef(null),c=s.useRef(),r=s.useRef(0),h=s.useRef(0),y=s.useRef(0),f=s.useRef(0),w=4,v=800,$=80,K=35,p=.5,M=3,N=.8,te=.6,O=300,H=s.useCallback(u=>Math.pow(Math.min(u/8,1),.7),[]),j=s.useCallback(u=>u<.2?{primary:`rgba(59, 130, 246, ${.4+u*.4})`,secondary:`rgba(96, 165, 250, ${.3+u*.3})`,accent:`rgba(147, 197, 253, ${.2+u*.2})`}:u<.5?{primary:`rgba(139, 92, 246, ${.5+u*.3})`,secondary:`rgba(167, 139, 250, ${.4+u*.3})`,accent:`rgba(196, 181, 253, ${.3+u*.2})`}:u<.8?{primary:`rgba(236, 72, 153, ${.6+u*.3})`,secondary:`rgba(244, 114, 182, ${.5+u*.3})`,accent:`rgba(251, 207, 232, ${.4+u*.2})`}:{primary:`rgba(239, 68, 68, ${.7+u*.3})`,secondary:`rgba(248, 113, 113, ${.6+u*.3})`,accent:`rgba(254, 202, 202, ${.5+u*.2})`},[]),U=s.useCallback(u=>{const T=Math.abs(u-.5),Y=Math.exp(-(T*T)/(2*.25*.25));return Math.max(Y,.02)},[]),b=s.useCallback(()=>{const u=m.current;if(!u)return;const i=u.getContext("2d");if(!i)return;const B=Date.now(),T=B-f.current;f.current=B,i.clearRect(0,0,v,$);const Y=B-(f.current||0),L=d&&n>0?H(n):0;let X=1;(!d||n===0||Y>O)&&(X=Math.exp(-T*.008));const ie=L*K-h.current;h.current+=ie*N,h.current*=X;const ge=p+L*(M-p)-y.current;y.current+=ge*te,y.current=Math.max(y.current*X,p),r.current+=(.02+L*.04)*y.current;const G=h.current/K,Q=j(G),E=i.createLinearGradient(0,0,v,0),F=Q.primary.replace(/rgba?\(([^)]+)\)/,(C,g)=>{const[J,A,k]=g.split(",").map(q=>q.trim());return`rgba(${J}, ${A}, ${k}, 0.1)`}),se=Q.secondary.replace(/rgba?\(([^)]+)\)/,(C,g)=>{const[J,A,k]=g.split(",").map(q=>q.trim());return`rgba(${J}, ${A}, ${k}, 0.4)`});E.addColorStop(0,F),E.addColorStop(.2,se),E.addColorStop(.4,Q.secondary),E.addColorStop(.5,Q.primary),E.addColorStop(.6,Q.secondary),E.addColorStop(.8,se),E.addColorStop(1,F);for(let C=0;C<w;C++){i.beginPath(),i.strokeStyle=E,i.lineWidth=(3.5-C*.5)*Math.min(G*1.5+.3,1),i.globalAlpha=(.8-C*.12)*Math.min(G*1.8+.2,1);const g=[],J=2,A=C*Math.PI/3,k=1+C*.25,q=h.current*(1-C*.15);for(let S=0;S<=v;S+=J){const R=S/v,re=U(R),z=q*re,xe=Math.sin(R*Math.PI*4*k+A+r.current*(1.5+C*.3))*z,P=Math.sin(R*Math.PI*8*k+A*1.3+r.current*(2.2+C*.4))*z*.35,I=Math.sin(R*Math.PI*16*k+A*1.8+r.current*(3.5+C*.6))*z*.12,D=Math.sin(Math.abs(R-.5)*Math.PI*12+r.current*2.8)*z*.08*re,ce=$/2+xe+P+I+D;g.push({x:S,y:ce})}if(g.length>2){i.moveTo(g[0].x,g[0].y);for(let S=1;S<g.length-2;S++){const R=(g[S].x+g[S+1].x)/2,re=(g[S].y+g[S+1].y)/2;i.quadraticCurveTo(g[S].x,g[S].y,R,re)}g.length>2&&i.quadraticCurveTo(g[g.length-2].x,g[g.length-2].y,g[g.length-1].x,g[g.length-1].y)}i.stroke()}h.current<3&&(i.beginPath(),i.fillStyle=`rgba(148, 163, 184, ${.2+Math.sin(r.current*2)*.1})`,i.arc(v/2,$/2,2,0,Math.PI*2),i.fill(),h.current<1.5&&(i.beginPath(),i.strokeStyle="rgba(148, 163, 184, 0.15)",i.lineWidth=1,i.globalAlpha=.3,i.setLineDash([3,6]),i.moveTo(v*.2,$/2),i.lineTo(v*.8,$/2),i.stroke(),i.setLineDash([]))),i.globalAlpha=1},[n,d,H,j,U]);return s.useEffect(()=>{f.current=Date.now();const u=()=>{b(),c.current=requestAnimationFrame(u)};return u(),()=>{c.current&&cancelAnimationFrame(c.current)}},[b]),s.useEffect(()=>{n>0&&(f.current=Date.now())},[n]),e.jsxs("div",{className:`relative overflow-hidden rounded-lg bg-transparent ${l}`,children:[e.jsx("canvas",{ref:m,width:v,height:$,className:"w-full h-full bg-transparent",style:{maxHeight:"80px"}}),h.current<2&&!d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-muted-foreground opacity-60 font-medium",children:"Start typing to see the waveform..."})})]})},Ae=s.forwardRef(({checked:n,onCheckedChange:d,className:l,disabled:m=!1,size:c="md",...r},h)=>{const y={sm:"h-4 w-7",md:"h-5 w-9",lg:"h-6 w-11"},f={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},w={sm:n?"translate-x-3":"translate-x-0",md:n?"translate-x-4":"translate-x-0",lg:n?"translate-x-5":"translate-x-0"};return e.jsx("button",{ref:h,type:"button",role:"switch","aria-checked":n,disabled:m,className:Me("relative inline-flex shrink-0 cursor-pointer rounded-full border-2 border-muted/30 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background bg-transparent",m&&"cursor-not-allowed opacity-50",y[c],l),onClick:()=>!m&&d(!n),...r,children:e.jsx("span",{className:Me("pointer-events-none inline-block rounded-full ring-0 transition-all duration-200 ease-in-out absolute top-1/2 transform -translate-y-1/2",n?"bg-green-500":"bg-red-500",f[c],w[c])})})});Ae.displayName="Toggle";const Tt=({timeRemaining:n,totalTime:d,className:l=""})=>{const m=s.useMemo(()=>Math.max(0,n/d*100),[n,d]),c=s.useMemo(()=>{const K=m;if(K>50){const p=(K-50)/50,M=Math.round(34+221*(1-p)),N=Math.round(197+58*(1-p)),te=Math.round(94*p);return`rgb(${M}, ${N}, ${te})`}else{const p=K/50,M=255,N=Math.round(255*p);return`rgb(${M}, ${N}, 0)`}},[m]),r=120,h=55,y=3,f=h-y,w=f*2*Math.PI,v=`${w} ${w}`,$=w-m/100*w;return e.jsxs("div",{className:`relative inline-flex items-center justify-center ${l}`,children:[e.jsxs("svg",{width:r,height:r,className:"transform -rotate-90",viewBox:`0 0 ${r} ${r}`,children:[e.jsx("circle",{fill:"white",r:f+5,cx:r/2,cy:r/2,className:"drop-shadow-md dark:fill-[rgb(28,46,56)]"}),e.jsx("circle",{stroke:"currentColor",strokeWidth:y,strokeOpacity:.1,fill:"transparent",r:f,cx:r/2,cy:r/2}),e.jsx("circle",{stroke:c,strokeWidth:y,strokeDasharray:v,strokeDashoffset:$,strokeLinecap:"round",fill:"transparent",r:f,cx:r/2,cy:r/2,className:"transition-all duration-300 ease-out"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold font-mono","data-testid":"timer-display",children:je(n)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Time Left"})]})]})},Pt=()=>{const n=Be(),[d]=_e(),{user:l,isAuthenticated:m}=Ve(),c=s.useRef(null),r=s.useRef(null),h=s.useRef(null),y=s.useRef(null),f=s.useRef(null),w=s.useRef(null),v=s.useRef(null),$=s.useRef(null),K=s.useRef(null),p=parseInt(d.get("timer")||"1"),M=d.get("difficulty")||"easy",[N,te]=s.useState(()=>fe(M,p)),[O,H]=s.useState(0),[j,U]=s.useState(""),[b,u]=s.useState(!1),[i,B]=s.useState(!1),[T,Y]=s.useState(!1),[L,X]=s.useState(p*60),[ie,ae]=s.useState(null),[ge,G]=s.useState(0),[Q,E]=s.useState(!1),[F,se]=s.useState(!1),[C,g]=s.useState(!1),[J,A]=s.useState(!1),[k,q]=s.useState(!1),[S,R]=s.useState(!1),[re,z]=s.useState(null),[xe,P]=s.useState(0),I=s.useRef(0),D=s.useRef([]),[ce,De]=s.useState(!0),[W,de]=s.useState({wpm:0,cpm:0,accuracy:0,timeRemaining:p*60,correctChars:0,incorrectChars:0,totalChars:0}),Ce=s.useCallback(()=>h.current&&h.current.getBoundingClientRect().width/5||16,[]),me=s.useCallback(()=>{if(!c.current||O===0)return 0;const a=c.current.offsetWidth,o=a/2,x=Ce(),ee=O*x-o+x/2,V=Math.max(0,ee);return a<768?V:Math.max(0,V-20)},[O,Ce]);s.useEffect(()=>{const t=me();G(t)},[O,me]),s.useEffect(()=>{const t=()=>{const a=me();G(a)};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[me]),s.useEffect(()=>{const t=a=>{T&&(a.preventDefault(),a.stopPropagation())};if(T)return document.addEventListener("keydown",t,!0),()=>document.removeEventListener("keydown",t,!0)},[T]),s.useEffect(()=>{E(!0),setTimeout(()=>E(!1),1500)},[]);const Ie=s.useCallback(()=>N.split("").map((t,a)=>{let o="upcoming";return a<O?o=j[a]===t?"correct":"incorrect":a===O&&(F||b)&&(o="current"),{char:t,status:o,isSpace:t===" "}}),[N,O,j,b,F])(),ke=s.useCallback(()=>{const t=N.split(" ");let a=0,o=[];for(let x=0;x<t.length&&(a+=t[x].length+1,o.push(t[x]),!(a>100));x++);return o.join(" ")},[N])(),Le=ke.length;s.useEffect(()=>{let t=null;return b&&L>0&&!i&&(t=setInterval(()=>{X(a=>a<=1?(u(!1),B(!0),Y(!0),0):a-1)},1e3)),()=>{t&&clearInterval(t)}},[b,L,i]),s.useEffect(()=>{const t=a=>{b&&(a.preventDefault(),window.history.pushState(null,"",window.location.href),window.confirm("Your typing test is in progress. Are you sure you want to leave? Your progress will be lost.")&&(u(!1),window.history.back()))};return b&&(window.history.pushState(null,"",window.location.href),window.addEventListener("popstate",t)),()=>{window.removeEventListener("popstate",t)}},[b]),s.useEffect(()=>{const t=setInterval(()=>{b?Date.now()-I.current>300&&P(o=>o*.85):P(a=>a*.8)},50);return()=>clearInterval(t)},[b]),s.useEffect(()=>{const t=j.split("").filter((Z,ee)=>Z===N[ee]).length,a=Math.max(0,j.length-t),o=j.length,x=ie?(Date.now()-ie)/1e3:0;de({wpm:Ke(t,x),cpm:Ye(t,x),accuracy:Xe(t,o),timeRemaining:L,correctChars:t,incorrectChars:a,totalChars:o})},[j,N,L,ie]),s.useEffect(()=>{setTimeout(()=>{r.current?r.current.focus():c.current&&c.current.focus()},100)},[]),s.useEffect(()=>{const t=()=>{if(document.visibilityState==="visible"&&i){console.log("User returned to completed test - generating new text");const a=fe(M,p);te(a),H(0),U(""),u(!1),B(!1),Y(!1),X(p*60),ae(null),de({wpm:0,cpm:0,accuracy:100,timeRemaining:p*60,correctChars:0,incorrectChars:0,totalChars:0}),q(!1),A(!1),z(null),P(0),D.current=[],I.current=0,setTimeout(()=>{r.current?r.current.focus():c.current&&c.current.focus()},100)}};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}},[i,M,p]);const Ne=(t,a=!1)=>{if(!(i||T)){if(g(t.getModifierState("CapsLock")),t.key==="Backspace"){if(t.preventDefault(),ne(),j.length>0){const o=j.slice(0,-1);U(o),H(o.length),!a&&r.current&&(r.current.value=o)}}else if(t.key.length===1){t.preventDefault();const o=j+t.key,x=Date.now();if(ne(),I.current>0){const Z=(x-I.current)/1e3,ee=Z>0?1/Z:0;D.current.push(ee),D.current.length>3&&D.current.shift();let V=0,oe=0;D.current.forEach((ve,he)=>{const Re=Math.pow(1.5,he);V+=ve*Re,oe+=Re});const ye=oe>0?V/oe:0;P(ye)}else P(4);I.current=x,!b&&!i&&(u(!0),ae(x)),o.length<=N.length&&(U(o),H(o.length),!a&&r.current&&(r.current.value=o))}}},ze=t=>{Ne(t,!1)},Pe=t=>{Ne(t,!0)},We=t=>{if(i||T)return;const a=t.target.value,o=Date.now();if(ne(),a.length>j.length){if(I.current>0){const x=(o-I.current)/1e3,Z=x>0?1/x:0;D.current.push(Z),D.current.length>3&&D.current.shift();let ee=0,V=0;D.current.forEach((ye,ve)=>{const he=Math.pow(1.5,ve);ee+=ye*he,V+=he});const oe=V>0?ee/V:0;P(oe)}else P(4);I.current=o,!b&&!i&&(u(!0),ae(o))}a.length<=N.length?(U(a),H(a.length)):t.target.value=j},ne=()=>{if(le&&f.current){const t=f.current.querySelector('[data-testid="timer-display"]');t?t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}):f.current.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}},Se=()=>{se(!0),ne()},Te=()=>se(!1),$e=()=>{i||T||(ne(),r.current?r.current.focus():c.current&&c.current.focus())},le=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);s.useEffect(()=>{if(le&&F&&r.current){const t=o=>{b&&!i&&!T&&(o.preventDefault(),r.current&&setTimeout(()=>{var x;return(x=r.current)==null?void 0:x.focus()},0))},a=r.current;return a.addEventListener("blur",t),()=>{a.removeEventListener("blur",t)}}},[le,F,b,i,T]),s.useEffect(()=>{if(!le)return;const t=()=>{F&&c.current&&ne()},a=window.visualViewport;return a?(a.addEventListener("resize",t),()=>{a.removeEventListener("resize",t)}):(window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)})},[le,F]);const Fe=async()=>{console.log("handleSaveResult called"),console.log("isAuthenticated:",m),console.log("user:",l),console.log("user?.username:",l==null?void 0:l.username);const t=(l==null?void 0:l.user)||l,a=t==null?void 0:t.username;if(!m||!a){console.error("Authentication check failed:",{isAuthenticated:m,user:l,username:a}),z("You must be logged in to save results");return}try{A(!0),z(null);const o={wpm:W.wpm,cpm:W.cpm,accuracy:W.accuracy,totalTime:p*60-L,difficulty:M,totalChars:W.totalChars,correctChars:W.correctChars,incorrectChars:W.incorrectChars};await et(o,a),q(!0)}catch(o){console.error("Failed to save result:",o),z(o instanceof Error?o.message:"Failed to save result")}finally{A(!1)}},qe=()=>{!k&&m?R(!0):n("/")},Oe=()=>{R(!1),n("/")},He=t=>{if(!t){Y(!1);const a=fe(M,p);te(a),H(0),U(""),u(!1),B(!1),X(p*60),ae(null),G(0),E(!1),se(!1),P(0),I.current=0,D.current=[],A(!1),q(!1),R(!1),z(null),de({wpm:0,cpm:0,accuracy:0,timeRemaining:p*60,correctChars:0,incorrectChars:0,totalChars:0}),setTimeout(()=>{r.current?r.current.focus():c.current&&c.current.focus()},100)}},Ue=()=>{te(fe(M,p)),H(0),U(""),u(!1),B(!1),Y(!1),X(p*60),ae(null),G(0),E(!1),se(!1),P(0),I.current=0,D.current=[],A(!1),q(!1),R(!1),z(null),de({wpm:0,cpm:0,accuracy:0,timeRemaining:p*60,correctChars:0,incorrectChars:0,totalChars:0}),setTimeout(()=>{r.current?r.current.focus():c.current&&c.current.focus()},100)},_={wpm:W.wpm,cpm:W.cpm,accuracy:W.accuracy,totalTime:p*60-L,difficulty:M};return e.jsxs("div",{className:"min-h-screen p-4 bg-gradient-to-br from-background via-background to-muted/20 relative overflow-hidden",style:{paddingTop:"max(env(safe-area-inset-top), 20px)"},children:[e.jsx(tt,{backUrl:"/"}),e.jsx("div",{className:"absolute inset-0 flex items-start justify-center pt-[200px] md:pt-[220px] z-0",children:e.jsx("div",{className:"absolute rounded-full pointer-events-none",style:{width:"min(180vh, 90vw)",height:"min(180vh, 90vw)",transform:"translate(-50%, -50%)",backgroundColor:"rgba(34, 197, 94, 0.15)",boxShadow:"0 0 80px rgba(34, 197, 94, 0.3), 0 0 160px rgba(34, 197, 94, 0.15)",border:"1px solid rgba(34, 197, 94, 0.1)"}})}),e.jsx("div",{className:"fixed z-0",style:{bottom:"-65vh",right:"-55vh"},children:e.jsx("div",{className:"rounded-full pointer-events-none",style:{width:"100vh",height:"100vh",backgroundColor:"rgba(34, 197, 94, 0.15)",boxShadow:"0 0 60px rgba(34, 197, 94, 0.3), 0 0 120px rgba(34, 197, 94, 0.15)",border:"1px solid rgba(34, 197, 94, 0.1)"}})}),e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 relative z-10",children:[e.jsx("div",{className:"pt-16 sm:pt-20 md:pt-24"}),e.jsxs("div",{className:"flex items-center justify-center max-w-2xl mx-auto gap-3 sm:gap-6 md:gap-8",children:[e.jsx(be,{className:"w-20 sm:w-24 h-12 sm:h-14 flex items-center justify-center flex-shrink-0 bg-white dark:bg-[rgb(28,46,56)] border border-border rounded-lg shadow-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg sm:text-xl font-bold","data-testid":"wpm-display",children:W.wpm}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"WPM"})]})}),e.jsx("div",{ref:f,className:"flex-shrink-0",children:e.jsx(Tt,{timeRemaining:L,totalTime:p*60})}),e.jsx(be,{className:"w-20 sm:w-24 h-12 sm:h-14 flex items-center justify-center flex-shrink-0 bg-white dark:bg-[rgb(28,46,56)] border border-border rounded-lg shadow-md",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg sm:text-xl font-bold","data-testid":"accuracy-display",children:[W.accuracy,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:"Accuracy"})]})})]}),e.jsxs("div",{ref:y,className:"relative",children:[e.jsx("div",{ref:w,className:"absolute top-2 right-2 z-10",children:e.jsx(Ae,{checked:ce,onCheckedChange:De,size:"sm",className:"bg-background/80 backdrop-blur-sm border border-border/50"})}),ce&&e.jsx(St,{typingSpeed:xe,isActive:b,className:"h-20"}),!ce&&e.jsx("div",{className:"h-20 flex items-center justify-center bg-muted/20 rounded-lg border border-dashed border-muted-foreground/30",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"Waveform visualizer disabled"})})]}),e.jsxs(be,{className:"border-2 bg-white dark:bg-[rgb(28,46,56)]",children:[e.jsx(Ge,{ref:K,children:e.jsxs("div",{ref:v,className:"flex items-center",children:[e.jsx("div",{className:"flex-1"}),e.jsx(Qe,{ref:$,className:"text-center whitespace-nowrap text-sm sm:text-base md:text-xl",children:"Type the text below"}),e.jsx("div",{className:"flex-1 flex justify-end",children:e.jsx("div",{className:`px-3 py-1 rounded-md text-white text-sm font-mono font-bold transition-colors duration-150 ${C?"bg-green-500":"bg-gray-400"}`,title:C?"Caps Lock is ON":"Caps Lock is OFF",children:C?"A":"a"})})]})}),e.jsxs(Je,{className:"space-y-6",children:[e.jsx("input",{ref:r,type:"text",value:j,onChange:We,onKeyDown:Pe,onFocus:Se,onBlur:Te,className:"absolute opacity-0 pointer-events-none z-[-1]",style:{position:"absolute",left:"50%",top:"50%",width:"1px",height:"1px",transform:"translate(-50%, -50%)"},autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,"aria-hidden":"true",tabIndex:-1}),e.jsxs("div",{ref:c,className:"typing-text h-32 sm:h-24 p-4 sm:p-6 bg-muted/20 rounded-lg overflow-hidden relative cursor-text","data-testid":"typing-area",tabIndex:0,onKeyDown:ze,onFocus:Se,onBlur:Te,onClick:$e,style:{border:"none",outline:"none"},children:[e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{borderRadius:"0.5rem"},children:e.jsx("rect",{x:"1",y:"1",width:"calc(100% - 2px)",height:"calc(100% - 2px)",rx:"8",ry:"8",fill:"none",stroke:"rgb(34, 197, 94)",strokeWidth:"2",strokeDasharray:"8 4",strokeDashoffset:"0",className:F?"":"animate-marching-ants",style:{opacity:.6}})}),e.jsx("div",{className:"absolute top-0 left-1/2 w-px h-full bg-primary/30 pointer-events-none z-10"}),e.jsx("span",{ref:h,className:"typing-char absolute opacity-0 pointer-events-none",style:{top:"-9999px",left:"-9999px"},children:"abcde"}),e.jsx("div",{className:"absolute top-6 left-6 whitespace-nowrap transition-transform duration-150 ease-out will-change-transform",style:{transform:`translateX(-${ge}px)`},children:Q?e.jsxs("div",{className:"inline-block",children:[e.jsx(Nt,{text:ke,isAnimating:Q,staggerDelay:7,className:"typing-char-upcoming"}),e.jsx("span",{className:"typing-char-upcoming opacity-30",children:N.slice(Le)})]}):Ie.map((t,a)=>{let o="typing-char inline-block ",x=t.char;switch(t.status){case"correct":o+="typing-char-correct";break;case"incorrect":o+="typing-char-incorrect",x=j[a]||t.char;break;case"current":o+="typing-char-current";break;case"upcoming":o+="typing-char-upcoming";break}return e.jsx("span",{className:o,"data-testid":`char-${a}`,children:x===" "?"Â ":x},a)})})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsxs(ue,{onClick:Ue,variant:"outline",className:"w-full sm:w-auto","data-testid":"retake-button",children:[e.jsx(yt,{className:"w-4 h-4 mr-2"}),"Retake Test"]})})]})]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs(ue,{onClick:()=>n("/"),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-4 h-4"}),"Back to Setup Screen"]})}),e.jsx(rt,{open:T,onOpenChange:He,children:e.jsxs(at,{className:"w-[90vw] max-w-md mx-auto","data-testid":"results-modal",children:[e.jsxs(nt,{children:[e.jsxs(ot,{className:"flex items-center gap-2 text-2xl",children:[e.jsx(we,{className:"w-6 h-6 text-green-600"}),"Test Complete!"]}),e.jsx(it,{children:"Here are your TapTest results"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-primary","data-testid":"final-wpm",children:_.wpm}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Words per Minute"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-primary","data-testid":"final-cpm",children:_.cpm}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Characters per Minute"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold","data-testid":"final-accuracy",children:[_.accuracy,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Accuracy"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"final-time",children:je(Math.round(_.totalTime))}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Time"})]})]}),e.jsx("div",{className:"text-center p-3 bg-primary/10 rounded-lg",children:e.jsxs("div",{className:"text-sm font-medium",children:["Difficulty: ",e.jsx("span",{className:"capitalize",children:_.difficulty})]})})]}),re&&e.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-destructive",children:re})}),k&&e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Result saved successfully!"})]})}),e.jsxs("div",{className:"py-4 flex justify-center",children:[e.jsx(Ee,{size:"mobile",slot:"results-modal-ad",className:"mx-auto sm:hidden max-w-[300px]"}),e.jsx(Ee,{size:"rectangle",slot:"results-modal-ad",className:"mx-auto hidden sm:block"})]}),e.jsxs(ct,{className:"flex-col sm:flex-row gap-3",children:[m&&e.jsx(ue,{onClick:k?()=>n("/profile"):Fe,disabled:J,className:`w-full transition-all duration-500 ease-in-out transform ${k?"scale-105":"scale-100"}`,variant:k?"outline":"default","data-testid":k?"check-profile-button":"save-result-button",children:J?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):k?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-2 animate-pulse"}),"Check Profile"]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-4 h-4 mr-2"}),"Save Result"]})}),e.jsxs(ue,{onClick:qe,variant:m&&!k?"outline":"default",className:"w-full","data-testid":"back-to-setup-button",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"Back to Setup"]}),!m&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center w-full",children:[e.jsx(ue,{variant:"link",onClick:()=>n("/login"),className:"p-0 h-auto text-xs",children:"Log in"})," ","to save your results to your profile"]})]})]})}),e.jsx(lt,{open:S,onOpenChange:R,children:e.jsxs(ut,{className:"w-[95vw] max-w-md mx-auto",children:[e.jsxs(dt,{children:[e.jsxs(mt,{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[e.jsx(Ze,{className:"w-5 h-5"}),"Unsaved Results"]}),e.jsxs(ht,{className:"text-left",children:["You haven't saved your test results yet. Your performance data will be lost if you continue.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Your Results:"}),e.jsx("div",{className:"mt-2 p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"WPM:"})," ",_.wpm]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Accuracy:"})," ",_.accuracy,"%"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Time:"})," ",je(Math.round(_.totalTime))]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Difficulty:"})," ",_.difficulty]})]})}),e.jsx("br",{}),"Would you like to go back and save your results first?"]})]}),e.jsxs(ft,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(pt,{onClick:Oe,className:"w-full bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Yes, Discard Results"}),e.jsx(gt,{onClick:()=>R(!1),className:"w-full",children:"No, Keep Results"})]})]})})]})]})};export{Pt as default};
