import{u as N,n as G,r as p,j as e,C as M,a as T,d as F,e as A,f as P,B as j,o as k}from"./index-9221375f.js";import{U,L as z,C as B,a as O,A as R}from"./checkbox-b7108782.js";import{I as y,E as D}from"./input-e8968fa3.js";import{E as H}from"./eye-027734d1.js";import"./Logo-d9ed2dce.js";import"./check-2e5c824c.js";const $=({onSubmit:m,onSignUpClick:h,isLoading:u=!1,className:l=""})=>{const t=N(),f=G({onSuccess:async s=>{try{g(!0),i({}),console.log("Google login success, getting user info...");const r=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${s.access_token}`}});if(!r.ok)throw new Error("Failed to get user info from Google");const d=await r.json();console.log("Google user info:",d);const o=await k.googleLoginWithUserInfo({id:d.id,email:d.email,name:d.name,picture:d.picture});console.log("ğŸ” Google login response:",o),console.log("ğŸ” Google login response.user:",o.user),console.log("ğŸ” Google login response.user.profile_picture:",o.user.profile_picture),localStorage.setItem("accessToken",o.accessToken),localStorage.setItem("refreshToken",o.refreshToken),localStorage.setItem("user",JSON.stringify(o.user)),console.log("Google login successful for user:",o.user.username),t("/")}catch(r){console.error("Google login failed:",r),i({general:r instanceof Error?r.message:"Google sign in failed"})}finally{g(!1)}},onError:()=>{console.error("Google OAuth error"),i({general:"Google sign in failed"})}}),[n,b]=p.useState({username:"",password:"",rememberMe:!1}),[a,i]=p.useState({}),[x,C]=p.useState(!1),[w,g]=p.useState(!1),S=/^[a-zA-Z0-9_]{3,20}$/,E=()=>{const s={};if(!n.username)s.username="Username is required";else{const r=n.username.trim();S.test(r)||(s.username="Username must be 3-20 characters (letters, numbers, underscore only)")}return n.password?n.password.length<6&&(s.password="Password must be at least 6 characters"):s.password="Password is required",i(s),Object.keys(s).length===0},v=s=>r=>{const d=s==="rememberMe"?r.target.checked:r.target.value;b(o=>({...o,[s]:d})),a[s]&&i(o=>({...o,[s]:void 0}))},I=async s=>{if(s.preventDefault(),!!E()){g(!0),i({});try{await(m==null?void 0:m(n))}catch(r){i({general:r instanceof Error?r.message:"Login failed. Please try again."})}finally{g(!1)}}},L=()=>{C(s=>!s)},c=u||w;return e.jsxs(M,{className:`w-full ${l}`,children:[e.jsxs(T,{className:"space-y-1",children:[e.jsx(F,{className:"text-2xl text-center",children:"Welcome back"}),e.jsx(A,{className:"text-center",children:"Welcome back to TapTest"})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(j,{onClick:()=>f(),variant:"outline",className:"w-full relative h-10 border border-border/50 bg-background hover:bg-accent hover:text-accent-foreground transition-colors",disabled:w||u,children:[e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Sign in with Google"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-card px-2 text-muted-foreground",children:"Or continue with"})})]})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[a.general&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",role:"alert","aria-live":"polite",children:a.general}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"username",className:"text-sm font-medium leading-none",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(y,{id:"username",type:"text",placeholder:"Enter your username",value:n.username,onChange:v("username"),className:`pl-10 ${a.username?"border-red-500 focus-visible:ring-red-500":""}`,disabled:c,"aria-invalid":!!a.username,"aria-describedby":a.username?"username-error":void 0,autoComplete:"username","data-testid":"username-input"})]}),a.username&&e.jsx("p",{id:"username-error",className:"text-sm text-red-600",role:"alert","aria-live":"polite",children:a.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"password",className:"text-sm font-medium leading-none",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(y,{id:"password",type:x?"text":"password",placeholder:"Enter your password",value:n.password,onChange:v("password"),className:`pl-10 pr-10 ${a.password?"border-red-500 focus-visible:ring-red-500":""}`,disabled:c,"aria-invalid":!!a.password,"aria-describedby":a.password?"password-error":void 0,autoComplete:"current-password","data-testid":"password-input"}),e.jsx("button",{type:"button",onClick:L,className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground hover:text-foreground transition-colors",disabled:c,"aria-label":x?"Hide password":"Show password","data-testid":"password-toggle",children:x?e.jsx(D,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"})})]}),a.password&&e.jsx("p",{id:"password-error",className:"text-sm text-red-600",role:"alert","aria-live":"polite",children:a.password})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(B,{id:"remember-me",label:"Remember me",checked:n.rememberMe,onCheckedChange:s=>b(r=>({...r,rememberMe:s})),disabled:c,"data-testid":"remember-me-checkbox"})}),e.jsx(j,{type:"submit",className:"w-full",disabled:c,"data-testid":"login-button",children:c?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):"Sign in"}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Don't have an account?"," ",e.jsx("button",{type:"button",onClick:h,className:"text-primary hover:text-primary/80 underline-offset-4 hover:underline font-medium transition-colors",disabled:c,"data-testid":"sign-up-link",children:"Sign up"})]})]})]})]})},K=()=>{const m=N(),h=async l=>{try{console.log("Login attempt:",l.username,"Remember me:",l.rememberMe);const t=await k.login({username:l.username,password:l.password});localStorage.setItem("accessToken",t.accessToken),localStorage.setItem("refreshToken",t.refreshToken),localStorage.setItem("user",JSON.stringify(t.user)),l.rememberMe?(localStorage.setItem("rememberMe","true"),console.log("Remember me enabled - tokens will persist longer")):localStorage.removeItem("rememberMe"),console.log("Login successful for user:",t.user.username),m("/")}catch(t){console.error("Login failed:",t);const f=t instanceof Error?t.message:"Login failed";throw new Error(f)}},u=()=>{m("/register")};return e.jsx(R,{children:e.jsx($,{onSubmit:h,onSignUpClick:u})})};export{K as default};
