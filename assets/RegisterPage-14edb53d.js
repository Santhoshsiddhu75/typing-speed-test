import{u as F,n as M,r as m,R as D,j as e,C as J,a as _,d as q,e as V,f as W,B as P,o as U}from"./index-9221375f.js";import{U as Z,L as R,C as X,a as Y,A as K}from"./checkbox-b7108782.js";import{I as S,E as $}from"./input-e8968fa3.js";import{C as x}from"./check-2e5c824c.js";import{I as Q}from"./info-67a90601.js";import{E as A}from"./eye-027734d1.js";import{X as b}from"./x-e3e22843.js";import"./Logo-d9ed2dce.js";const ee=({onSubmit:u,onTermsClick:j,onSignInClick:v,isLoading:g=!1,className:p=""})=>{const i=F(),N=M({onSuccess:async s=>{try{f(!0),d({}),console.log("Google signup success, getting user info...");const r=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${s.access_token}`}});if(!r.ok)throw new Error("Failed to get user info from Google");const l=await r.json();console.log("Google user info:",l);const t=await U.googleLoginWithUserInfo({id:l.id,email:l.email,name:l.name,picture:l.picture});console.log("ðŸ” Google signup response:",t),console.log("ðŸ” Google signup response.user:",t.user),console.log("ðŸ” Google signup response.user.profile_picture:",t.user.profile_picture),localStorage.setItem("accessToken",t.accessToken),localStorage.setItem("refreshToken",t.refreshToken),localStorage.setItem("user",JSON.stringify(t.user)),console.log("Google signup successful for user:",t.user.username),i("/")}catch(r){console.error("Google signup failed:",r),d({general:r instanceof Error?r.message:"Google sign up failed"})}finally{f(!1)}},onError:()=>{console.error("Google OAuth error"),d({general:"Google sign up failed"})}}),[o,T]=m.useState({username:"",password:"",confirmPassword:"",acceptTerms:!1}),[a,d]=m.useState({}),[y,z]=m.useState(!1),[C,L]=m.useState(!1),[I,f]=m.useState(!1),[h,E]=m.useState(!1);D.useEffect(()=>{const s=()=>{h&&E(!1)};if(h)return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[h]);const O=/^[a-zA-Z0-9_]{3,20}$/,n=m.useMemo(()=>{const s=o.password,r={length:s.length>=8,uppercase:/[A-Z]/.test(s),lowercase:/[a-z]/.test(s),number:/\d/.test(s)},l=Object.values(r).filter(Boolean).length;let t="Weak",w="bg-red-500";return l>=4?(t="Strong",w="bg-green-500"):l>=3?(t="Good",w="bg-blue-500"):l>=2&&(t="Fair",w="bg-yellow-500"),{score:l,label:t,color:w,criteria:r}},[o.password]),B=()=>{const s={};if(!o.username)s.username="Username is required";else{const r=o.username.trim();O.test(r)||(s.username="Username must be 3-20 characters (letters, numbers, underscore only)")}return o.password?o.password.length<8?s.password="Password must be at least 8 characters":n.score<3&&(s.password="Password must contain uppercase, lowercase, and number"):s.password="Password is required",o.confirmPassword?o.password!==o.confirmPassword&&(s.confirmPassword="Passwords do not match"):s.confirmPassword="Please confirm your password",o.acceptTerms||(s.acceptTerms="You must accept the terms and conditions"),d(s),Object.keys(s).length===0},k=s=>r=>{const l=s==="acceptTerms"?r.target.checked:r.target.value;T(t=>({...t,[s]:l})),a[s]&&d(t=>({...t,[s]:void 0})),s==="password"&&a.confirmPassword&&d(t=>({...t,confirmPassword:void 0}))},H=async s=>{if(s.preventDefault(),!!B()){f(!0),d({});try{await(u==null?void 0:u(o))}catch(r){d({general:r instanceof Error?r.message:"Registration failed. Please try again."})}finally{f(!1)}}},G=s=>{s==="password"?z(r=>!r):L(r=>!r)},c=g||I;return e.jsxs(J,{className:`w-full ${p}`,children:[e.jsxs(_,{className:"space-y-1",children:[e.jsx(q,{className:"text-2xl text-center",children:"Join TapTest"}),e.jsx(V,{className:"text-center",children:e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold text-primary",children:"Track"})," progress & ",e.jsx("span",{className:"font-semibold text-primary",children:"compete"})," with others"]})})]}),e.jsxs(W,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(P,{onClick:()=>N(),variant:"outline",className:"w-full relative h-10 border border-border/50 bg-background hover:bg-accent hover:text-accent-foreground transition-colors",disabled:I||g,children:[e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Sign up with Google"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-card px-2 mb-3 text-muted-foreground",children:"Or continue with"})})]})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[a.general&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",role:"alert","aria-live":"polite",children:a.general}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 space-y-2",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-500 flex-shrink-0 mt-0.5 flex items-center justify-center",children:e.jsx(x,{className:"w-2 h-2 text-white"})}),e.jsx("div",{className:"text-sm",children:e.jsxs("p",{className:"font-medium text-blue-900 dark:text-blue-100 mb-1",children:[e.jsx("span",{className:"sm:hidden text-[11px]",children:"Just pick any username!"}),e.jsx("span",{className:"hidden sm:inline text-[11px]",children:"No email needed. Pick a username!"})]})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"username",className:"text-sm font-medium leading-none",children:"Username"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"hidden sm:inline text-[10px] text-muted-foreground/60",children:"Can't be changed later"}),e.jsxs("div",{className:"relative sm:hidden",children:[e.jsx(P,{type:"button",variant:"ghost",size:"sm",className:"h-5 w-5 p-0 hover:bg-muted/50",onClick:()=>E(!h),"aria-label":"Username information",children:e.jsx(Q,{className:"h-3 w-3 text-muted-foreground"})}),h&&e.jsxs("div",{className:"absolute top-6 right-0 bg-popover text-popover-foreground text-xs p-2 rounded-md shadow-lg border border-border z-10 w-40",children:[e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Can't be changed later"})}),e.jsx("div",{className:"absolute -top-1 right-2 w-2 h-2 bg-popover border-l border-t border-border rotate-45"})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(S,{id:"username",type:"text",placeholder:"Choose your username",value:o.username,onChange:k("username"),className:`pl-10 ${a.username?"border-red-500 focus-visible:ring-red-500":""}`,disabled:c,"aria-invalid":!!a.username,"aria-describedby":a.username?"username-error":"username-help",autoComplete:"username","data-testid":"username-input"})]}),a.username&&e.jsx("p",{id:"username-error",className:"text-sm text-red-600",role:"alert","aria-live":"polite",children:a.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"password",className:"text-sm font-medium leading-none",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(S,{id:"password",type:y?"text":"password",placeholder:"Create a password",value:o.password,onChange:k("password"),className:`pl-10 pr-10 ${a.password?"border-red-500 focus-visible:ring-red-500":""}`,disabled:c,"aria-invalid":!!a.password,"aria-describedby":a.password?"password-error":"password-strength",autoComplete:"new-password","data-testid":"password-input"}),e.jsx("button",{type:"button",onClick:()=>G("password"),className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground hover:text-foreground transition-colors",disabled:c,"aria-label":y?"Hide password":"Show password","data-testid":"password-toggle",children:y?e.jsx($,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]}),o.password&&e.jsxs("div",{id:"password-strength",className:"space-y-2","aria-live":"polite",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Password strength:"}),e.jsx("span",{className:`text-xs font-medium ${n.score>=3?"text-green-600":n.score>=2?"text-blue-600":n.score>=1?"text-yellow-600":"text-red-600"}`,children:n.label})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${n.color}`,style:{width:`${n.score/4*100}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[e.jsxs("div",{className:`flex items-center gap-1 ${n.criteria.length?"text-green-600":"text-muted-foreground"}`,children:[n.criteria.length?e.jsx(x,{className:"h-3 w-3"}):e.jsx(b,{className:"h-3 w-3"}),"8+ characters"]}),e.jsxs("div",{className:`flex items-center gap-1 ${n.criteria.uppercase?"text-green-600":"text-muted-foreground"}`,children:[n.criteria.uppercase?e.jsx(x,{className:"h-3 w-3"}):e.jsx(b,{className:"h-3 w-3"}),"Uppercase"]}),e.jsxs("div",{className:`flex items-center gap-1 ${n.criteria.lowercase?"text-green-600":"text-muted-foreground"}`,children:[n.criteria.lowercase?e.jsx(x,{className:"h-3 w-3"}):e.jsx(b,{className:"h-3 w-3"}),"Lowercase"]}),e.jsxs("div",{className:`flex items-center gap-1 ${n.criteria.number?"text-green-600":"text-muted-foreground"}`,children:[n.criteria.number?e.jsx(x,{className:"h-3 w-3"}):e.jsx(b,{className:"h-3 w-3"}),"Number"]})]})]}),a.password&&e.jsx("p",{id:"password-error",className:"text-sm text-red-600",role:"alert","aria-live":"polite",children:a.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"text-sm font-medium leading-none",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(S,{id:"confirmPassword",type:C?"text":"password",placeholder:"Confirm your password",value:o.confirmPassword,onChange:k("confirmPassword"),className:`pl-10 pr-10 ${a.confirmPassword?"border-red-500 focus-visible:ring-red-500":""}`,disabled:c,"aria-invalid":!!a.confirmPassword,"aria-describedby":a.confirmPassword?"confirmPassword-error":void 0,autoComplete:"new-password","data-testid":"confirmPassword-input"}),e.jsx("button",{type:"button",onClick:()=>G("confirmPassword"),className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground hover:text-foreground transition-colors",disabled:c,"aria-label":C?"Hide password":"Show password","data-testid":"confirmPassword-toggle",children:C?e.jsx($,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]}),a.confirmPassword&&e.jsx("p",{id:"confirmPassword-error",className:"text-sm text-red-600",role:"alert","aria-live":"polite",children:a.confirmPassword})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(X,{id:"accept-terms",label:e.jsxs("span",{children:[" ",e.jsx("button",{type:"button",onClick:j,className:"text-primary hover:text-primary/80 underline-offset-4 hover:underline",disabled:c,children:"Terms and Conditions"})]}),checked:o.acceptTerms,onCheckedChange:s=>T(r=>({...r,acceptTerms:s})),disabled:c,"data-testid":"accept-terms-checkbox"}),a.acceptTerms&&e.jsx("p",{className:"text-sm text-red-600",role:"alert","aria-live":"polite",children:a.acceptTerms})]}),e.jsx(P,{type:"submit",className:"w-full",disabled:c,"data-testid":"register-button",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating account..."]}):"Create Account"}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Already have an account?"," ",e.jsx("button",{type:"button",onClick:v,className:"text-primary hover:text-primary/80 underline-offset-4 hover:underline font-medium transition-colors",disabled:c,"data-testid":"sign-in-link",children:"Sign in"})]})]})]})]})},ce=()=>{const u=F(),j=async p=>{try{console.log("Registration attempt:",p.username);const i=await U.register({username:p.username,password:p.password});localStorage.setItem("accessToken",i.accessToken),localStorage.setItem("refreshToken",i.refreshToken),localStorage.setItem("user",JSON.stringify(i.user)),console.log("Registration successful for user:",i.user.username),u("/")}catch(i){console.error("Registration failed:",i);const N=i instanceof Error?i.message:"Registration failed";throw new Error(N)}},v=()=>{console.log("Terms and conditions clicked")},g=()=>{u("/login")};return e.jsx(K,{children:e.jsx(ee,{onSubmit:j,onTermsClick:v,onSignInClick:g})})};export{ce as default};
